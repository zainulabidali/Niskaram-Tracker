<!DOCTYPE html>
<html lang="ml">
<head>
  <meta charset="UTF-8">
  <title>Prayer History</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    h3 {
      margin-bottom: 10px;
    }
    .table-wrapper {
      overflow-x: auto;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 800px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 6px 10px;
      text-align: center;
    }
    th {
      background-color: #f5f5f5;
    }
    tbody tr:nth-child(even) {
      background-color: #fafafa;
    }
    strong {
      color: #2c3e50;
    }
  </style>
</head>
<body>

  <div id="history-section">
    <h3>üìú ‡¥ï‡µÅ‡¥ü‡µç‡¥ü‡¥ø‡¥ï‡¥≥‡µÅ‡¥ü‡µÜ ‡¥Æ‡µÅ‡¥¥‡µÅ‡¥µ‡µª ‡¥™‡µç‡¥∞‡¥æ‡µº‡¥•‡¥®‡¥æ ‡¥π‡¥ø‡¥∏‡µç‡¥±‡µç‡¥±‡¥±‡¥ø</h3>
    <div class="table-wrapper">
      <table id="history-table">
        <thead>
          <tr>
            <th>‡¥™‡µá‡¥∞‡µç</th>
            <th>‡¥§‡µÄ‡¥Ø‡¥§‡¥ø</th>
            <th>‡¥∏‡µÅ‡¥¨‡¥π‡µç</th>
            <th>‡¥≥‡µÅ‡¥π‡µç‡µº</th>
            <th>‡¥Ö‡¥∏‡µº</th>
            <th>‡¥Æ‡¥ó‡¥∞‡¥ø‡¥¨‡µç</th>
            <th>‡¥á‡¥∑‡¥æ</th>
            <th>‡¥∏‡µç‡¥ï‡µã‡µº</th>
            <th>‡¥Æ‡µä‡¥§‡µç‡¥§‡¥Ç ‡¥∏‡µç‡¥ï‡µã‡µº</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script type="module">
    import { ref, get } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-database.js";
    import { database } from './firebase.js';

    const tableBody = document.querySelector("#history-table tbody");
    const totalScores = {}; // name -> total score

   async function loadHistory() {
  const snapshot = await get(ref(database, 'prayers'));
  if (!snapshot.exists()) return;

  const data = snapshot.val();
  const totalScores = {}; // name => sum of scores

  // First, calculate total scores for each name across all dates
  Object.values(data).forEach(students => {
    Object.entries(students).forEach(([name, prayers]) => {
      const score = [prayers.fajr, prayers.dhuhr, prayers.asr, prayers.maghrib, prayers.isha]
        .filter(Boolean).length;

      if (!totalScores[name]) totalScores[name] = 0;
      totalScores[name] += score;
    });
  });

  // Now display rows in date-descending order
  const sortedDates = Object.keys(data).sort().reverse();
  for (const date of sortedDates) {
    const students = data[date];
    const sortedNames = Object.keys(students).sort(); // optional: alphabetical

    for (const name of sortedNames) {
      const prayers = students[name];
      const fajr = prayers.fajr ? "‚úÖ" : "‚ùå";
      const dhuhr = prayers.dhuhr ? "‚úÖ" : "‚ùå";
      const asr = prayers.asr ? "‚úÖ" : "‚ùå";
      const maghrib = prayers.maghrib ? "‚úÖ" : "‚ùå";
      const isha = prayers.isha ? "‚úÖ" : "‚ùå";

      const todayScore = [prayers.fajr, prayers.dhuhr, prayers.asr, prayers.maghrib, prayers.isha]
        .filter(Boolean).length;

      const row = document.createElement("tr");
      row.innerHTML = `
        <td><strong>${name}</strong></td>
        <td>${date}</td>
        <td>${fajr}</td>
        <td>${dhuhr}</td>
        <td>${asr}</td>
        <td>${maghrib}</td>
        <td>${isha}</td>
        <td>${todayScore}</td>
        <td>${totalScores[name]}</td>
      `;
      tableBody.appendChild(row);
    }
  }
}


    loadHistory();
  </script>
</body>
</html>
