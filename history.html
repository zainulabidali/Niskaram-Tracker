<!DOCTYPE html>
<html lang="ml">
<head>
  <meta charset="UTF-8">
  <title>Prayer History</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    h3 {
      margin-bottom: 10px;
    }
    .table-wrapper {
      overflow-x: auto;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 800px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 6px 10px;
      text-align: center;
    }
    th {
      background-color: #f5f5f5;
    }
    tbody tr:nth-child(even) {
      background-color: #fafafa;
    }
    strong {
      color: #2c3e50;
    }

    select {
      padding: 6px 12px;
      margin-bottom: 15px;
      font-size: 16px;
    }
  </style>
</head>
<body>

  <h3>üìú ‡¥ï‡µÅ‡¥ü‡µç‡¥ü‡¥ø‡¥ï‡¥≥‡µÅ‡¥ü‡µÜ ‡¥Æ‡µÅ‡¥¥‡µÅ‡¥µ‡µª ‡¥™‡µç‡¥∞‡¥æ‡µº‡¥•‡¥®‡¥æ ‡¥π‡¥ø‡¥∏‡µç‡¥±‡µç‡¥±‡¥±‡¥ø</h3>
  <br>

  <!-- üîΩ ‡¥ï‡µç‡¥≤‡¥æ‡¥∏‡µç ‡¥§‡¥ø‡¥∞‡¥û‡µç‡¥û‡µÜ‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡¥æ‡¥®‡µÅ‡¥≥‡µç‡¥≥ ‡¥∏‡µÜ‡¥≤‡¥ï‡µç‡¥ü‡µç -->
<style>
  .filter-section {
    display: flex;
    flex-direction: column;
    margin-bottom: 1rem;
    max-width: 480px;
    width: 100%;
  }

  .filter-section label {
    font-weight: bold;
    margin-bottom: 6px;
    color: #6d0101;
  }

  .filter-section select {
    padding: 10px;
    font-size: 18px;
    border-radius: 6px;
    border: 1px solid #271e1e;
    background-color: #d4dee7d9;
    appearance: none;
    background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%204%205'%3E%3Cpath%20fill='%23666'%20d='M2%200L0%202h4L2%200zm0%205L0%203h4l-2%202z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 30px center;
    background-size: 15px;
  }

  @media (max-width: 480px) {
    .filter-section select {
      font-size: 18px;
      padding: 12px;
    }
  }
</style>

<div class="filter-section">
  <label for="classFilter" style="text-align:center; display:block;">‡¥ï‡µç‡¥≤‡¥æ‡¥∏‡µç ‡¥§‡¥ø‡¥∞‡¥û‡µç‡¥û‡µÜ‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡µÅ‡¥ï:</label>
  <select id="classFilter">
    <option >-- ‡¥ï‡µç‡¥≤‡¥æ‡¥∏‡µç --</option>
    <option value="3">3-‡¥æ‡¥Ç ‡¥§‡¥∞‡¥Ç</option>
    <option value="4">4-‡¥æ‡¥Ç ‡¥§‡¥∞‡¥Ç</option>
    <option value="5">5-‡¥æ‡¥Ç ‡¥§‡¥∞‡¥Ç</option>
    <option value="6">6-‡¥æ‡¥Ç ‡¥§‡¥∞‡¥Ç</option>
    <option value="7">7-‡¥æ‡¥Ç ‡¥§‡¥∞‡¥Ç</option>
    <option value="8">8-‡¥æ‡¥Ç ‡¥§‡¥∞‡¥Ç</option>
    <option value="9">9-‡¥æ‡¥Ç ‡¥§‡¥∞‡¥Ç</option>
    <option value="10">10-‡¥æ‡¥Ç ‡¥§‡¥∞‡¥Ç</option>
  </select>
</div>


  <div class="table-wrapper">
    <table id="history-table">
      <thead>
        <tr>
          <th>‡¥™‡µá‡¥∞‡µç</th>
          <th>‡¥§‡µÄ‡¥Ø‡¥§‡¥ø</th>
          <th>‡¥∏‡µÅ‡¥¨‡¥π‡µç</th>
          <th>‡¥≥‡µÅ‡¥π‡µç‡µº</th>
          <th>‡¥Ö‡¥∏‡µº</th>
          <th>‡¥Æ‡¥ó‡¥∞‡¥ø‡¥¨‡µç</th>
          <th>‡¥á‡¥∑‡¥æ</th>
          <th>‡¥∏‡µç‡¥ï‡µã‡µº</th>
          <th>‡¥Æ‡µä‡¥§‡µç‡¥§‡¥Ç ‡¥∏‡µç‡¥ï‡µã‡µº</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  

  <script type="module">
    import { ref, get } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-database.js";
    import { database } from './firebase.js';

    const tableBody = document.querySelector("#history-table tbody");
    const classFilter = document.getElementById('classFilter');
    let fullData = {}; // ‡¥é‡¥≤‡µç‡¥≤‡¥æ ‡¥™‡µç‡¥∞‡¥æ‡µº‡¥§‡µç‡¥•‡¥® ‡¥°‡¥æ‡¥±‡µç‡¥±‡¥Ø‡µÅ‡¥Ç ‡¥á‡¥µ‡¥ø‡¥ü‡µÜ ‡¥∏‡µç‡¥±‡µç‡¥±‡µã‡µº ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥Ç

    async function loadHistory() {
      const snapshot = await get(ref(database, 'prayers'));
      if (!snapshot.exists()) return;

      fullData = snapshot.val();
      renderTable(); // ‡¥Æ‡µÅ‡¥¥‡µÅ‡¥µ‡µª ‡¥°‡¥æ‡¥±‡µç‡¥± ‡¥µ‡¥®‡µç‡¥®‡µÅ ‡¥ï‡¥¥‡¥ø‡¥û‡µç‡¥û‡¥æ‡µΩ ‡¥Ü‡¥¶‡µç‡¥Ø‡¥Æ‡¥æ‡¥Ø‡¥ø ‡¥ü‡µá‡¥¨‡¥ø‡µæ ‡¥´‡¥ø‡µΩ ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥ï
    }

    // üîÅ ‡¥ï‡µç‡¥≤‡¥æ‡¥∏‡µç ‡¥Æ‡¥æ‡¥±‡µç‡¥±‡µÅ‡¥Æ‡µç‡¥™‡µã‡µæ ‡¥ü‡µá‡¥¨‡¥ø‡µæ ‡¥Ö‡¥™‡µç‡¥°‡µá‡¥±‡µç‡¥±‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥ï
    classFilter.addEventListener('change', renderTable);

    function renderTable() {
      tableBody.innerHTML = '';
      const selectedClass = classFilter.value;
      const totalScores = {};

      // ‡¥Æ‡µä‡¥§‡µç‡¥§‡¥Ç ‡¥∏‡µç‡¥ï‡µã‡µº ‡¥ï‡¥£‡¥ï‡µç‡¥ï‡¥æ‡¥ï‡µç‡¥ï‡µÅ‡¥ï
      Object.values(fullData).forEach(students => {
        Object.entries(students).forEach(([name, prayers]) => {
          if (selectedClass && prayers.class !== selectedClass) return;
          const score = [prayers.fajr, prayers.dhuhr, prayers.asr, prayers.maghrib, prayers.isha].filter(Boolean).length;
          if (!totalScores[name]) totalScores[name] = 0;
          totalScores[name] += score;
        });
      });

      const sortedDates = Object.keys(fullData).sort().reverse();

      for (const date of sortedDates) {
        const students = fullData[date];
        const sortedNames = Object.keys(students).sort();

        for (const name of sortedNames) {
          const prayers = students[name];
          if (selectedClass && prayers.class !== selectedClass) continue;

          const fajr = prayers.fajr ? "‚úÖ" : "‚ùå";
          const dhuhr = prayers.dhuhr ? "‚úÖ" : "‚ùå";
          const asr = prayers.asr ? "‚úÖ" : "‚ùå";
          const maghrib = prayers.maghrib ? "‚úÖ" : "‚ùå";
          const isha = prayers.isha ? "‚úÖ" : "‚ùå";

          const todayScore = [prayers.fajr, prayers.dhuhr, prayers.asr, prayers.maghrib, prayers.isha].filter(Boolean).length;

          const row = document.createElement("tr");
          row.innerHTML = `
            <td><strong>${name}</strong></td>
            <td>${date}</td>
            <td>${fajr}</td>
            <td>${dhuhr}</td>
            <td>${asr}</td>
            <td>${maghrib}</td>
            <td>${isha}</td>
            <td>${todayScore}</td>
            <td>${totalScores[name]}</td>
          `;
          tableBody.appendChild(row);
        }
      }
    }

    loadHistory();
  </script>
</body>
</html>
